<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Loop Run Summary - 20260126_172555</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        h3 {
            color: #555;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .executive-summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            margin-bottom: 30px;
        }
        
        .executive-summary h2 {
            margin-top: 0;
            border-bottom: none;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-change {
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .metric-change.positive {
            color: #27ae60;
        }
        
        .metric-change.negative {
            color: #e74c3c;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-kept {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .status-reverted {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .change-summary {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .recommendations {
            background: #e7f3ff;
            padding: 25px;
            border-radius: 6px;
            border-left: 4px solid #2196F3;
            margin-top: 30px;
        }
        
        .recommendations ul {
            margin-left: 20px;
            margin-top: 15px;
        }
        
        .recommendations li {
            margin: 10px 0;
        }
        
        .key-findings {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .key-findings ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .key-findings li {
            margin: 8px 0;
        }
        
        .baseline-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .comparison-card h4 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Agent Loop Run Summary</h1>
        <p style="color: #666; margin-bottom: 30px;">
            <strong>Run ID:</strong> 20260126_172555<br>
            <strong>Test Case:</strong> Justin Gaethje vs Paddy Pimblett<br>
            <strong>Baseline Model:</strong> baseline_jan_26_new<br>
            <strong>Total Iterations:</strong> 4
        </p>
        
        <div class="executive-summary">
            <h2>Executive Summary</h2>
            <p style="margin-top: 15px;">
                This agent loop run successfully improved model performance by focusing on Top 25% confidence accuracy 
                while maintaining underdog betting performance. The run tested 4 iterations, with 2 changes kept and 2 reverted.
            </p>
            <div class="metric-grid" style="margin-top: 25px;">
                <div class="metric-card">
                    <div class="metric-label">Top 25% Accuracy</div>
                    <div class="metric-value">81.21%</div>
                    <div class="metric-change positive">+3.36 pp vs baseline</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Underdog Top 25% ROI</div>
                    <div class="metric-value">0.63</div>
                    <div class="metric-change positive">+0.11 vs baseline</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Underdog Top 25% Accuracy</div>
                    <div class="metric-value">60.9%</div>
                    <div class="metric-change positive">+1.8 pp vs baseline</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Overall Accuracy</div>
                    <div class="metric-value">66.67%</div>
                    <div class="metric-change negative">-0.33 pp vs baseline</div>
                </div>
            </div>
            <p style="margin-top: 20px; font-weight: 600; color: #27ae60;">
                ✓ Both primary objectives achieved: Top 25% accuracy improved significantly (+3.36 pp) while 
                underdog performance also improved (accuracy +1.8 pp, ROI +0.11).
            </p>
        </div>
        
        <h2>Iteration Summary Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Iteration</th>
                    <th>Change</th>
                    <th>Decision</th>
                    <th>Top 25% Accuracy</th>
                    <th>Underdog Top 25% Accuracy</th>
                    <th>Underdog Top 25% ROI</th>
                    <th>Overall Accuracy</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Baseline</strong></td>
                    <td>-</td>
                    <td>-</td>
                    <td>77.85%</td>
                    <td>59.1%</td>
                    <td>0.52</td>
                    <td>67.0%</td>
                </tr>
                <tr>
                    <td><strong>1</strong></td>
                    <td>Added <code>opponent_quality_score_diff_squared</code></td>
                    <td><span class="status-reverted">REVERTED</span></td>
                    <td>83.33% <span class="metric-change positive">(+5.48 pp)</span></td>
                    <td>47.6% <span class="metric-change negative">(-11.5 pp)</span></td>
                    <td>0.25 <span class="metric-change negative">(-0.27)</span></td>
                    <td>67.34% <span class="metric-change positive">(+0.34 pp)</span></td>
                </tr>
                <tr>
                    <td><strong>2</strong></td>
                    <td>Added <code>recent_form_quality_adjusted_diff</code></td>
                    <td><span class="status-reverted">REVERTED</span></td>
                    <td>79.19% <span class="metric-change positive">(+1.34 pp)</span></td>
                    <td>52.4% <span class="metric-change negative">(-6.7 pp)</span></td>
                    <td>0.38 <span class="metric-change negative">(-0.14)</span></td>
                    <td>64.98% <span class="metric-change negative">(-2.02 pp)</span></td>
                </tr>
                <tr>
                    <td><strong>3</strong></td>
                    <td>Fixed <code>common_opponent_performance_diff</code> bug</td>
                    <td><span class="status-kept">KEPT</span></td>
                    <td>80.54% <span class="metric-change positive">(+2.69 pp)</span></td>
                    <td>57.1% <span class="metric-change negative">(-2.0 pp)</span></td>
                    <td>0.49 <span class="metric-change negative">(-0.03)</span></td>
                    <td>65.99% <span class="metric-change negative">(-1.01 pp)</span></td>
                </tr>
                <tr>
                    <td><strong>4</strong></td>
                    <td>Added <code>striking_differential_x_opponent_quality_diff</code></td>
                    <td><span class="status-kept">KEPT</span></td>
                    <td>81.21% <span class="metric-change positive">(+3.36 pp)</span></td>
                    <td>60.9% <span class="metric-change positive">(+1.8 pp)</span></td>
                    <td>0.63 <span class="metric-change positive">(+0.11)</span></td>
                    <td>66.67% <span class="metric-change negative">(-0.33 pp)</span></td>
                </tr>
            </tbody>
        </table>
        
        <h2>Detailed Iteration Analysis</h2>
        
        <h3>Iteration 1: opponent_quality_score_diff_squared (REVERTED)</h3>
        <div class="change-summary">
            <p><strong>Change:</strong> Added squared version of opponent quality difference to amplify large quality gaps.</p>
            <p><strong>Rationale:</strong> The model was under-weighting significant opponent quality advantages (e.g., Gaethje's 4.6x advantage).</p>
            <p><strong>Outcome:</strong> Improved Top 25% accuracy significantly (+5.48 pp) but severely degraded underdog performance (-11.5 pp accuracy, -52% ROI).</p>
            <p><strong>Decision Reason:</strong> The severe underdog regression outweighed the Top 25% gain. The squared feature was too aggressive in favoring favorites.</p>
        </div>
        
        <h3>Iteration 2: recent_form_quality_adjusted_diff (REVERTED)</h3>
        <div class="change-summary">
            <p><strong>Change:</strong> Added feature comparing recent win rates weighted by opponent quality scores.</p>
            <p><strong>Rationale:</strong> Distinguish between fighters with similar recent records but different competition levels (e.g., 0.667 win rate vs elite vs weaker opponents).</p>
            <p><strong>Outcome:</strong> Modest Top 25% improvement (+1.34 pp) but degraded underdog performance (-6.7 pp accuracy, -14 pp ROI) and overall accuracy (-2.02 pp).</p>
            <p><strong>Decision Reason:</strong> Followed same pattern as iteration 1 - improved Top 25% but harmed underdog identification. Overall accuracy also decreased.</p>
        </div>
        
        <h3>Iteration 3: Fixed common_opponent_performance_diff (KEPT)</h3>
        <div class="change-summary">
            <p><strong>Change:</strong> Fixed bug where feature returned 0.0 despite common opponents existing. Now properly aggregates wins across all fights against common opponents.</p>
            <p><strong>Rationale:</strong> Common opponent analysis provides direct comparative evidence without inherent bias toward favorites or underdogs.</p>
            <p><strong>Outcome:</strong> Meaningful Top 25% improvement (+2.69 pp) with moderate underdog degradation (-2.0 pp accuracy, -3 pp ROI).</p>
            <p><strong>Decision Reason:</strong> The Top 25% improvement was significant enough to keep, despite slight underdog impact. Bug fixes that restore functionality are valuable.</p>
        </div>
        
        <h3>Iteration 4: striking_differential_x_opponent_quality_diff (KEPT)</h3>
        <div class="change-summary">
            <p><strong>Change:</strong> Added interaction feature multiplying striking differential by opponent quality difference.</p>
            <p><strong>Rationale:</strong> Weight striking advantages more heavily when achieved against elite competition. Only activates when BOTH conditions are met.</p>
            <p><strong>Outcome:</strong> Improved both Top 25% accuracy (+3.36 pp) AND underdog performance (+1.8 pp accuracy, +0.11 ROI). First iteration to improve both goals simultaneously.</p>
            <p><strong>Decision Reason:</strong> The selective activation (requiring both striking AND quality advantages) successfully identified elite favorites without over-penalizing underdogs.</p>
        </div>
        
        <h2>Key Findings</h2>
        <div class="key-findings">
            <ul>
                <li><strong>Direct amplification approaches fail:</strong> Squared features and quality-adjusted weighting consistently improved Top 25% accuracy but harmed underdog identification (iterations 1-2).</li>
                <li><strong>Interaction features are more balanced:</strong> Iteration 4's interaction feature improved both Top 25% accuracy and underdog performance by requiring multiple conditions to activate.</li>
                <li><strong>Bug fixes are valuable:</strong> Fixing the broken <code>common_opponent_performance_diff</code> feature provided meaningful improvement, though even "neutral" features can have subtle biases.</li>
                <li><strong>Selective activation works:</strong> Features that only activate under specific conditions (e.g., both striking AND quality advantages) preserve underdog signal better than always-on amplification.</li>
                <li><strong>Balance is critical:</strong> The run prioritized maintaining both Top 25% accuracy and underdog performance, leading to reversion of changes that improved one at the expense of the other.</li>
            </ul>
        </div>
        
        <h2>What to Keep / What to Discard</h2>
        
        <h3>✓ Keep These Changes</h3>
        <div class="baseline-comparison">
            <div class="comparison-card">
                <h4>Iteration 3: common_opponent_performance_diff Fix</h4>
                <p><strong>Impact:</strong> +2.69 pp Top 25% accuracy</p>
                <p><strong>Reason:</strong> Bug fix that restores functionality. Provides direct comparative evidence when common opponents exist.</p>
                <p><strong>Note:</strong> Monitor for subtle favorite bias, but improvement justifies keeping.</p>
            </div>
            <div class="comparison-card">
                <h4>Iteration 4: striking_differential_x_opponent_quality_diff</h4>
                <p><strong>Impact:</strong> +3.36 pp Top 25% accuracy, +1.8 pp underdog accuracy, +0.11 ROI</p>
                <p><strong>Reason:</strong> First feature to improve both primary goals. Selective activation pattern is successful.</p>
                <p><strong>Note:</strong> This is the model's best performing iteration - both goals achieved.</p>
            </div>
        </div>
        
        <h3>✗ Discard These Approaches</h3>
        <div class="baseline-comparison">
            <div class="comparison-card">
                <h4>Direct Quality Amplification</h4>
                <p><strong>Examples:</strong> <code>opponent_quality_score_diff_squared</code>, <code>recent_form_quality_adjusted_diff</code></p>
                <p><strong>Why:</strong> Uniformly amplify differences, improving favorites but harming underdogs. Pattern seen in iterations 1-2.</p>
                <p><strong>Alternative:</strong> Use threshold-based or interaction features with selective activation.</p>
            </div>
            <div class="comparison-card">
                <h4>Always-On Quality Features</h4>
                <p><strong>Examples:</strong> Quality-adjusted recent form features that always weight by opponent quality</p>
                <p><strong>Why:</strong> Over-weight favorites without preserving underdog signal in closer matchups.</p>
                <p><strong>Alternative:</strong> Interaction features requiring multiple conditions, or threshold-based features for extremes only.</p>
            </div>
        </div>
        
        <h2>Recommended Next Experiments</h2>
        <div class="recommendations">
            <h3>High Priority</h3>
            <ul>
                <li><strong>Threshold-based extreme quality feature:</strong> Create <code>opponent_quality_score_diff_extreme</code> that only activates for absolute differences > 0.2. This should capture large quality advantages (like Gaethje's 0.282) while preserving underdog signal in closer matchups. Follows the selective activation pattern that worked in iteration 4.</li>
            </ul>
            
            <h3>Medium Priority</h3>
            <ul>
                <li><strong>Age × Opponent Quality interaction:</strong> Create <code>age_x_opponent_quality_diff</code> to reduce age penalty when quality advantage is large. The test case showed age penalty may over-compensate for experience advantage. This interaction follows the successful selective activation pattern.</li>
                <li><strong>Recent form × Opponent Quality interaction:</strong> Explore interaction features combining recent win rates with opponent quality, following the pattern from iteration 4. This could distinguish similar win rates against different competition levels without the negative underdog impact seen in iteration 2.</li>
            </ul>
            
            <h3>Lower Priority / Monitoring</h3>
            <ul>
                <li><strong>Monitor common_opponent_performance_diff:</strong> While kept, this feature shows slight favorite bias. Consider adjustments if underdog performance degrades further.</li>
                <li><strong>Composite elite experience feature:</strong> Consider combining opponent quality, title fight experience, and beaten opponent win rates into a single normalized score. However, test carefully to avoid the direct amplification pitfalls seen in iterations 1-2.</li>
            </ul>
            
            <h3>General Principles for Future Iterations</h3>
            <ul>
                <li><strong>Prefer selective activation:</strong> Features that require multiple conditions (like iteration 4) are more balanced than always-on features.</li>
                <li><strong>Test both goals simultaneously:</strong> Any change must improve or maintain both Top 25% accuracy AND underdog performance.</li>
                <li><strong>Fix broken features first:</strong> Bug fixes (like iteration 3) can provide meaningful improvements with minimal risk.</li>
                <li><strong>Avoid uniform amplification:</strong> Squared features and direct quality weighting consistently harm underdogs despite improving favorites.</li>
            </ul>
        </div>
        
        <h2>Final Model Performance</h2>
        <div class="metric-grid" style="margin-top: 20px;">
            <div class="metric-card">
                <div class="metric-label">Top 25% Accuracy</div>
                <div class="metric-value">81.21%</div>
                <div class="metric-change positive">vs 77.85% baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Top 10% Accuracy</div>
                <div class="metric-value">93.33%</div>
                <div class="metric-change positive">vs 86.67% baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Underdog Top 25% Accuracy</div>
                <div class="metric-value">60.9%</div>
                <div class="metric-change positive">vs 59.1% baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Underdog Top 25% ROI</div>
                <div class="metric-value">0.63</div>
                <div class="metric-change positive">vs 0.52 baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">AUC</div>
                <div class="metric-value">0.7268</div>
                <div class="metric-change positive">vs 0.7129 baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Brier Score</div>
                <div class="metric-value">0.2122</div>
                <div class="metric-change positive">vs 0.2165 baseline</div>
            </div>
        </div>
        
        <p style="margin-top: 30px; padding: 20px; background: #d4edda; border-radius: 6px; color: #155724;">
            <strong>✓ Success:</strong> The final model (iteration 4) successfully improved both primary objectives: 
            Top 25% confidence accuracy increased by 3.36 percentage points, while underdog top 25% performance 
            also improved (accuracy +1.8 pp, ROI +0.11). The interaction feature approach proved to be the key 
            to achieving balanced improvements.
        </p>
    </div>
</body>
</html>